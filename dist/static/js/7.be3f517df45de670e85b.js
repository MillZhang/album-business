webpackJsonp([7,43],{129:function(t,e,a){var i=a(30)(a(420),a(320),null,null);t.exports=i.exports},133:function(t,e,a){a(390);var i=a(30)(a(424),a(337),"data-v-5d0029c5",null);t.exports=i.exports},176:function(t,e,a){"use strict";(function(t){var i=a(59),o=a.n(i),r=a(60),s=a.n(r),n=a(34),d=a(33),p=a(35),l=a.n(p);e.a=new(function(){function e(){o()(this,e)}return s()(e,[{key:"initPhotoList",value:function(){for(var t=[],e=d.a.layout().getter(),a=0,i=e.length;a<i;a++){var o=e[a],r={};r.list=[],r.size=o.area.length,r.main=o.layoutStyle.main,r.sub=o.layoutStyle.sub,r.temp=o.id,r.wait=0,r.bw=n.a.getConstant().EditorWidth,r.dpr=document.documentElement.getAttribute("data-dpr");for(var s=0;s<r.size;s++){var p={};p.width=0,p.height=0,p.key="",p.degree=0,p.location={position:{left:0,top:0},layoutIndex:s+1},r.list.push(p)}t.push(r)}d.a.photoList().setter(t)}},{key:"updatePhotoContainer",value:function(t){var e=d.a.photoList().getter();null==d.a.tempPhoto().getter()&&d.a.tempPhoto().setter(e[t]);var a=d.a.layout().getter()[t],i={};i.list=[],i.size=a.area.length,i.temp=a.id,i.bw=n.a.getConstant().EditorWidth,i.dpr=document.documentElement.getAttribute("data-dpr"),i.main=a.layoutStyle.main,i.sub=a.layoutStyle.sub,i.wait=0;for(var o=0;o<i.size;o++){var r={};r.width=0,r.height=0,r.key="",r.degree=0,r.location={position:{left:0,top:0},layoutIndex:o+1},i.list.push(r)}return e[t]=this.updatePhotoContent(t,i),d.a.photoList().setter(e),i}},{key:"updatePhotoContent",value:function(t,e){if(void 0!=e.list){for(var a=d.a.tempPhoto().getter(),i=a.list,o=0;o<i.length;o++){var r=i[o],s=e.list[o];""!=r.key&&void 0!=s&&(e.list[o]={width:r.width,height:r.height,key:r.key,degree:r.degree,location:{position:this.centeringImage(t,o,r.width,r.height),layoutIndex:o+1}},e.wait+=1)}return e}}},{key:"setCacheData",value:function(t){d.a.layout().setter(t.layout),this.initPhotoList()}},{key:"setEitorPage",value:function(t,e,a,i){if(null==d.a.layout().getter())return"";var o=d.a.layout().getter()[t],r=o.area[e],s=o.scale,p=(o.tw,o.th,r.aw/r.ah),h=o.tw*s/a,u={position:"absolute",width:r.aw*s/h+"px",height:r.ah*s/h+"px",left:r.ax*s/h+"px",top:r.ay*s/h+"px",overflow:"hidden",zIndex:100+t,backgroundRepeat:"no-repeat"};if(!i){var c=(d.a.photoList().getter()[t],d.a.photoList().getter()[t].list),f=a/n.a.getConstant().EditorWidth;if(void 0!=c){var g=c[e];if(""==g.key||0==g.width)u.background="url("+l.a+") center no-repeat",u.backgroundPosition="100% 100%",u.backgroundSize="100% 100%";else{var m=encodeURI(n.a.getConstant().DOMAIN+g.key+n.a.getConstant().THUMB600+"/rotate/"+g.degree),v=void 0,y=void 0;u.backgroundImage="url("+m+")",u.backgroundPosition=g.location.position.left*f.toFixed(2)+"px "+g.location.position.top*f.toFixed(2)+"px";p>=g.width/g.height?(v="100%",y="auto"):(v="auto",y="100%"),u.backgroundSize=v+" "+y}}}return u}},{key:"getTemplateImage",value:function(t){if(null==d.a.layout().getter())return"";var e=d.a.layout().getter()[t];return void 0==e?"":e.pngImg+n.a.getConstant().THUMB600}},{key:"getPhotoItemImageUrl",value:function(t,e){var a=d.a.photoList().getter()[t].list;if(void 0!=a){var i=a[e];return""==i.key||0==i.width?l.a:encodeURI(n.a.getConstant().DOMAIN+i.key+n.a.getConstant().THUMB600+"/rotate/"+i.degree)}}},{key:"setPhotoItemImageStyle",value:function(t,e){var a=d.a.layout().getter()[t],i=a.area[e],o=(a.tw,a.th,i.aw/i.ah),r=(a.tw,n.a.getConstant().EditorWidth,d.a.photoList().getter()[t].list);if(void 0!=r){var s=r[e],p=void 0,l=void 0,h={position:"absolute",left:s.location.position.left.toFixed(2)+"px",top:s.location.position.top.toFixed(2)+"px"};if(""==s.key||0==s.width)h.width="100%",h.height="100%";else{o>=s.width/s.height?(p="100%",l="auto"):(p="auto",l="100%"),h.width=p,h.height=l}return h}}},{key:"fillImageByGroup",value:function(e){for(var a=d.a.photoList().getter(),i=0,o=0;o<a.length;o++){var r=a[o],s=r.list;if(void 0!=s)for(;r.size>r.wait&&i!=e.length;){var n=t(e[i]).find("img");s[r.wait]=this.replaceImageBySequence(o,r.wait,n),r.wait+=1,i++}}d.a.photoList().setter(a)}},{key:"fillImageByPage",value:function(e,a){var i=d.a.photoList().getter(),o=0,r=i[a],s=r.list;if(void 0!=s)for(;r.size>r.wait&&o!=e.length;){var n=t(e[o]).find("img");s[r.wait]=this.replaceImageBySequence(Number(a),r.wait,n),r.wait+=1,o++}d.a.photoList().setter(i),d.a.tempPhoto().setter(d.a.photoList().getter()[a])}},{key:"fillImageByIndex",value:function(e,a,i){var o=t(e[0]).find("img"),r=d.a.photoList().getter();r[a].list[i]=this.replaceImageBySequence(Number(a),Number(i),o),d.a.photoList().setter(r),d.a.tempPhoto().setter(d.a.photoList().getter()[a])}},{key:"rotateImage",value:function(t,e){var a=d.a.photoList().getter(),i=a[t];if(void 0!=i.list){var o=i.list[e],r=o.width,s=o.height,n=o.degree;o.degree=(Number(n)+90)%360,o.width=s,o.height=r,o.location.position=this.centeringImage(t,e,o.width,o.height)}return d.a.photoList().setter(a),i}},{key:"replaceImageBySequence",value:function(t,e,a){var i=a.attr("data-width"),o=a.attr("data-height"),r=a.attr("data-degree");return{width:i,height:o,key:a.attr("data-key"),degree:r,location:{position:this.centeringImage(t,e,i,o),layoutIndex:Number(e)+1}}}},{key:"centeringImage",value:function(t,e,a,i){var o=d.a.layout().getter()[t],r=o.area[e],s={};if(void 0!=r){var p=r.aw/r.ah,l=o.tw/n.a.getConstant().EditorWidth;if(p>=a/i){var h=r.aw/l/a;s={maxTop:0,minTop:-(i*h-r.ah/l).toFixed(2),left:0,top:-((i*h-r.ah/l)/2).toFixed(2)}}else{var u=r.ah/l/i;s={maxLeft:0,minLeft:-(a*u-r.aw/l).toFixed(2),left:-((a*u-r.aw/l)/2).toFixed(2),top:0}}return s}}},{key:"getRestEmptyCount",value:function(){var t=d.a.photoList().getter(),e=0;if(null==t)return e;for(var a=0;a<t.length;a++){var i=t[a];void 0!=i.list&&(e+=i.size-i.wait)}return e}},{key:"getImageRadio",value:function(){var t=d.a.layout().getter()[0];return t.tw/t.th}},{key:"getRestEmptyCountByPage",value:function(t){var e=d.a.photoList().getter(),a=e[t];return a.size-a.wait}},{key:"touchStart",value:function(e){if(1===e.targetTouches.length){var a=t(".edit")[0],i=e.targetTouches[0],o=e.target;return{x:i.pageX-a.offsetLeft,y:i.pageY-a.offsetTop,ix:o.offsetLeft,iy:o.offsetTop}}}},{key:"touchMove",value:function(e,a,i){if(1==e.targetTouches.length){var o=e.targetTouches[0],r=e.target,s=t(".edit")[0],n=o.pageX-s.offsetLeft,d=o.pageY-s.offsetLeft,p=n-a.x,l=d-a.y,h=t(r).position().left,u=t(r).position().top;"auto"==r.style.height?u>=i.minTop-10&&u<=i.maxTop+10&&t(r).css({top:a.iy+l}):"auto"==r.style.width&&h>=i.minLeft-10&&h<=i.maxLeft+10&&t(r).css({left:a.ix+p})}}},{key:"touchEnd",value:function(e,a,i,o,r){var s=e.target;return"auto"==s.style.height?o.maxTop>=o.minTop?t(s).position().top>=o.maxTop?t(s).css({top:o.maxTop}):t(s).position().top<=o.minTop&&t(s).css({top:o.minTop}):r():"auto"==s.style.width&&(o.maxLeft>=o.minLeft?t(s).position().left>=o.maxLeft?t(s).css({left:o.maxLeft}):t(s).position().left<=o.minLeft&&t(s).css({left:o.minLeft}):r()),this.cachePhotoAfterMoving(t(s),a,i),!0}},{key:"cachePhotoAfterMoving",value:function(t,e,a){var i=d.a.photoList().getter(),o=i[e].list,r=t.position();o[a].location.position.left=r.left,o[a].location.position.top=r.top,d.a.photoList().setter(i)}},{key:"dealWidthDifferentDevice",value:function(t){if(null!=t){for(var e=0,a=t.length;e<a;e++){var i=t[e];if(void 0!=i.list){var o=i.bw,r=n.a.getConstant().EditorWidth/o;i.bw=n.a.getConstant().EditorWidth;for(var s=0;s<i.list.length;s++){var p=i.list[s];for(var l in p.location.position){var h=p.location.position[l];p.location.position[l]=Number((h*r).toFixed(2))}}}}d.a.photoList().setter(t)}}}]),e}())}).call(e,a(15))},232:function(t,e,a){e=t.exports=a(118)(),e.push([t.i,'.editor[data-v-5d0029c5]{border-left:1px solid #fff;background:#ededed;overflow:hidden}.editor .tip[data-v-5d0029c5]{padding:.02rem .2rem;color:#777;width:100%;box-sizing:border-box}[data-dpr="2"] .editor .tip[data-v-5d0029c5]{font-size:20px}[data-dpr="3"] .editor .tip[data-v-5d0029c5]{font-size:30px}.editor .tip span[data-v-5d0029c5]{margin-left:10px;color:#bc223d}[data-dpr="2"] .editor .tip span[data-v-5d0029c5]{font-size:20px}[data-dpr="3"] .editor .tip span[data-v-5d0029c5]{font-size:30px}.editor .floor-info[data-v-5d0029c5]{position:relative;height:.6rem;line-height:.6rem;padding-left:.2rem;float:left;width:80%;margin:.1rem .3rem;box-sizing:border-box}.editor .floor-info[data-v-5d0029c5]:before{content:"";width:.14rem;height:.14rem;background:#969696;display:block;position:absolute;left:-.2rem;top:.2rem;border-radius:50%;z-index:2}.editor .floor-info[data-v-5d0029c5]:after{content:"";width:1px;height:5.4rem;background:#fff;position:absolute;left:-.14rem;top:.4rem}.editor .floor[data-v-5d0029c5]{border-radius:4px;margin-left:.4rem;padding:.3rem 0;display:-ms-flexbox;display:flex;display:-webkit-flex;width:100%;box-sizing:border-box}.editor .block[data-v-5d0029c5]{width:44%;float:left;background:#f8f8f8;padding:1%}.editor .block.ml[data-v-5d0029c5]{margin-left:4%;border-right:2px solid #fff}.editor .block img[data-v-5d0029c5]{width:100%}.editor .block .edit[data-v-5d0029c5]{width:100%;display:block;position:relative;z-index:999}.editor .block .edit .pageDiv[data-v-5d0029c5]{position:relative;width:100%;height:100%}.editor .block .edit .pageDiv .templateDiv[data-v-5d0029c5]{width:100%;height:100%;position:relative;z-index:1000}.footer[data-v-5d0029c5]{bottom:0;width:100%;line-height:1.2rem;background:#fff;z-index:1000;display:-ms-flexbox;display:flex;display:-webkit-flex;box-shadow:0 0 5px #ccc}.footer>a[data-v-5d0029c5]{text-align:center;-ms-flex:1;flex:1;-webkit-flex:1;color:#fc6767}.footer>a[data-v-5d0029c5]:first-child{border-right:1px solid #ccc}',""])},320:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"index"})},staticRenderFns:[]}},337:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"editor page"},[a("section",{staticClass:"bar-footer"},[a("div",{staticClass:"footer"},[t.restCount>0?[a("router-link",{staticClass:"batch",attrs:{to:{path:"upload",query:{mode:"group",appid:t.appId}}}},[t._v("批量导入")])]:t._e(),t._v(" "),a("router-link",{staticClass:"preview",attrs:{to:{path:"preview",query:{appid:t.appId}}}},[t._v("预览")])],2)]),t._v(" "),a("section",{staticClass:"bar-content clearfix"},[a("div",{staticClass:"tip f12"},[t._v("您选择的产品是"+t._s(t.productName)),a("span",{staticClass:"f12"},[t._v("¥ "+t._s(t.productPrice))])]),t._v(" "),a("div",{staticClass:"tip f12"},[t._v("亲爱的用户,请最好一次性编辑完成相册,如果做一半离开,防止浏览器开小差丢了您的相册;点击照片进入【编辑】可以调整照片哦!")]),t._v(" "),t._l(t.photoList,function(e,i){return[i%2==0?[a("div",{staticClass:"floor-info",class:{mt0:0==i}},[0==i?[t._v("\n            封面/封底\n          ")]:t._e(),t._v(" "),2==i?[t._v("\n            扉页/第1页\n          ")]:[i==t.photoList.length-2?[t._v("\n              第"+t._s(i-2)+"页/扉底\n            ")]:t._e(),t._v(" "),i>2&&i<t.photoList.length-2?[t._v("\n              第"+t._s(i-2)+"页/第"+t._s(i-1)+"页\n            ")]:t._e()]],2)]:t._e(),t._v(" "),a("div",{staticClass:"block",class:{ml:i%2==0},on:{click:function(e){t.goDesignerEvent(i)}}},[a("div",{staticClass:"edit",style:{height:t.editorHeight+"px"},attrs:{href:"javascript:;","data-page":i}},[a("div",{staticClass:"pageDiv"},[a("div",{staticClass:"templateDiv",style:t.templateStyle(i)}),t._v(" "),t._l(e.list,function(e,o){return[a("div",{staticClass:"photoDiv",style:t.photoItemStyle(i,o)})]})],2)])])]})],2),t._v(" "),a("mt-actionsheet",{attrs:{closeOnClickModal:!1,actions:[{name:"重置相册",method:t.resetAlbum}]},model:{value:t.sheetVisible,callback:function(e){t.sheetVisible=e},expression:"sheetVisible"}})],1)},staticRenderFns:[]}},390:function(t,e,a){var i=a(232);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a(119)("01877d1a",i,!0)},420:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"index",data:function(){return{appId:this.$router.currentRoute.query.appid,flag:this.$router.currentRoute.query.flag.toLowerCase(),temporaryId:this.$router.currentRoute.query.temporaryId,pid:this.$router.currentRoute.query.pid,cfrom:this.$router.currentRoute.query.cfrom,albumId:this.$router.currentRoute.query.albumId}},created:function(){switch(console.log(this.flag),this.flag){case"team":this.$router.push("/team/list?appid="+this.appId);break;case"share":this.$router.push("/team/share?appid="+this.appId+"&temporaryId="+this.temporaryId);break;case"modern":this.$router.push("/modern/list?appid="+this.appId);break;case"base":this.$router.push("/base/list?appid="+this.appId);break;case"detail":this.$router.push("/base/detail?appid="+this.appId+"&id="+this.pid);break;case"w_share":this.$router.push("/common/previewer?appid="+this.appId+"&albumId="+this.albumId+"&cfrom="+this.cfrom+"&flag=share");break;case"paint":this.$router.push("/paint/detail?appid="+this.appId+"&id="+this.pid);break;case"paint_order":this.$router.push("/paint/oList?appid="+this.appId);break;case"paint_eval":this.$router.push("/paint/eval?appid="+this.appId);break;case"show":this.$router.push("/show/index?appid="+this.appId);break;case"base-orderlist":this.$router.push("/base/worklib?appid="+this.appId);break;case"team-orderlist":this.$router.push("/team/worklib?appid="+this.appId)}}}},424:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=a(33),o=a(176),r=a(57),s=a(31);a.n(s);e.default={name:"GlobalEditor",data:function(){return{editorWidth:.44*window.innerWidth,editorHeight:.44*window.innerWidth*1,mainHeight:window.innerHeight,gapHeight:"",backCoverImageUrl:"",coverImageUrl:"",productName:"",productPrice:0,hasCached:!1,photoList:[],pageSize:0,restCount:1,essentialData:{},sheetVisible:!1,temporaryId:this.$router.currentRoute.query.temporaryId,tempId:i.a.template().getter(),appId:this.$router.currentRoute.query.appid}},created:function(){i.a.tempPhoto().remove(),this.fetchCoverImage(),this.fetchAlbumData(),this.fetchEssentialData(),this.fetchProductData()},methods:{addedFunction:function(){var e=this;t(".cover").on("doubleTap",function(t){return t.preventDefault(),e.sheetVisible=!0,!1})},fetchAlbumData:function(){if(void 0!=this.temporaryId&&(null==i.a.temporary().getter()||this.temporaryId!=i.a.temporary().getter())){var t=this;r.a.getAlbumJson({ticket:App.config.ticket,temporaryId:this.temporaryId},function(e){e.success&&(i.a.remove(),t.tempId=e.data.tempId,i.a.template().setter(t.tempId),o.a.dealWidthDifferentDevice(JSON.parse(e.data.albumJson)),t.$nextTick(function(){t.photoList=i.a.photoList().getter(),i.a.layout().setter(JSON.parse(e.data.layoutJson)),t.editorHeight=t.editorWidth/o.a.getImageRadio(),t.restCount=o.a.getRestEmptyCount(),t.fetchCoverImage(),i.a.temporary().setter(t.temporaryId)}))})}},fetchEssentialData:function(){var t=this;null==i.a.photoList().getter()&&void 0==this.temporaryId&&r.a.getLayout({tempId:this.tempId,ticket:this.config.ticket},function(e){e.success&&(o.a.setCacheData(e.data),t.photoList=i.a.photoList().getter(),t.restCount=o.a.getRestEmptyCount(),t.editorHeight=t.editorWidth/o.a.getImageRadio())})},fetchProductData:function(){var t=this;r.a.getProduct({ticket:App.config.ticket},function(e){e.success&&(t.productName=e.data.productName,t.productPrice=e.data.productPrice)})},fetchCoverImage:function(){var t=this;null!=this.tempId&&r.a.getCoverImageByTempId({tempId:this.tempId,ticket:this.config.ticket},function(e){e.success&&(t.coverImageUrl=e.data.coverImageUrl,t.backCoverImageUrl=e.data.backCoverImageUrl)})},fetchAlbumCacheData:function(){r.a.getAlbumCacheData({ticket:App.config.ticket,random:(new Date).getTime()},function(t){t.success&&""!=t.data.albumJson&&(i.a.photoList().setter(JSON.parse(t.data.albumJson)),i.a.layout().setter(JSON.parse(t.data.layoutJson)),i.a.template().setter(t.data.tempId))})},goDesignerEvent:function(t){this.$router.push("/editor/design?page="+t)},templateStyle:function(t){return"background:url("+o.a.getTemplateImage(t)+") center no-repeat;background-size:cover"},photoItemStyle:function(t,e){return o.a.setEitorPage(t,e,this.editorWidth,!1)},resetAlbum:function(){var t=i.a.temporary().getter();i.a.remove(),this.photoList=[],void 0==t||null==t?this.$router.replace("/editor/template/?appid="+this.appId):this.$router.replace("/editor/global/?appid="+this.appId+"&temporaryId="+this.temporaryId)}},computed:{},mounted:function(){this.$nextTick(function(){this.photoList=i.a.photoList().getter(),this.restCount=o.a.getRestEmptyCount(),this.editorHeight=this.editorWidth/o.a.getImageRadio(),this.addedFunction(),this.gapHeight=t(".main").height()+this.editorHeight-100+"px"})},watch:{photoList:function(){0==this.photoList.length&&this.fetchAlbumData()}}}}).call(e,a(15))}});